<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ثبت نام مدرسه فوتسال عقاب قشقایی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/kamadatepicker/dist/kamadatepicker.min.css">
    <script src="https://unpkg.com/kamadatepicker" defer></script>
    <style>
        html {
            scroll-behavior: smooth; 
        }
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #121212; 
            color: #E0E0E0; 
        }
        .qashqai-pattern-bg {
            background-color: #161616; 
            background-image:
                linear-gradient(135deg, #6A0000 25%, transparent 25%),
                linear-gradient(225deg, #6A0000 25%, transparent 25%),
                linear-gradient(45deg, #6A0000 25%, transparent 25%),
                linear-gradient(315deg, #6A0000 25%, transparent 25%);
            background-position: 12px 0, 12px 0, 0 0, 0 0; 
            background-size: 24px 24px; 
            background-repeat: repeat;
        }
        .qashqai-border-subtle {
            border-bottom: 2px solid;
            border-image-slice: 1;
            border-image-source: linear-gradient(to left, #FF0000, #7B0000);
            padding-bottom: 8px;
        }
        .btn-primary {
            background-color: #FF0000; 
            color: white;
            transition: background-color 0.3s ease, transform 0.2s ease;
            position: relative; 
            overflow: hidden; 
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #CC0000; 
            transform: translateY(-2px);
        }
        .btn-primary:disabled {
            background-color: #555555;
            cursor: not-allowed;
        }
        .btn-primary .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        .btn-primary.loading .button-text {
            visibility: hidden;
        }
        .btn-primary.loading .loading-spinner {
            display: block;
        }
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .form-input {
            background-color: #2C2C2C;
            border: 1px solid #444444;
            color: #E0E0E0;
            border-radius: 0.375rem; 
        }
        .form-input:focus {
            border-color: #FF0000;
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 0, 0, 0.5);
        }
        .form-input.error-border { /* کلاس برای بردر قرمز در صورت خطای کد ملی تکراری */
            border-color: red !important;
        }
        .form-label {
            color: #B0B0B0;
        }
        .card {
            background-color: #1E1E1E;
            border-radius: 0.5rem; 
            padding: 1.5rem; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.2), 0 4px 6px -2px rgba(0,0,0,0.1); 
        }
        .logo-placeholder {
            width: 110px; 
            height: 110px;
            background-color: #FF0000;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem; 
            font-weight: bold;
            border-radius: 0.5rem; 
            margin: 0 auto;
            box-shadow: 0 4px 8px rgba(255,0,0,0.3);
        }
        #form-message {
            display: none;
            padding: 1.25rem; 
            margin-top: 1.5rem;
            border-radius: 0.375rem;
            text-align: center;
            font-weight: 500;
            font-size: 1.1rem; 
            line-height: 1.6;
        }
        #form-message.success {
            background-color: #059669; 
            color: white;
            border: 1px solid #047857;
        }
        #form-message.error {
            background-color: #DC2626; 
            color: white;
            border: 1px solid #B91C1C;
        }
         #form-message.info {
            background-color: #2563EB; 
            color: white;
            border: 1px solid #1D4ED8;
        }
        .contact-item {
            margin-bottom: 0.5rem; 
        }
        .contact-item a {
             direction: ltr; 
             display: inline-block;
        }
    </style>
</head>
<body class="antialiased">

    <header class="py-10 qashqai-pattern-bg">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-3">
                به مدرسه فوتسال <span style="color: #FF0000;">عقاب قشقایی</span> بپیوندید!
            </h1>
            <p class="text-lg md:text-xl text-gray-300">
                ثبت نام فصل جدید آغاز شد - استعداد خود را با مربیان حرفه‌ای شکوفا کنید.
            </p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 md:py-12">
        <section id="about" class="mb-12">
            <div class="card">
                <h2 class="text-3xl font-semibold mb-6 text-center qashqai-border-subtle" style="color: #FF0000;">
                    چرا مدرسه فوتسال عقاب قشقایی؟
                </h2>
                <div class="space-y-4 text-gray-300 text-justify md:text-right">
                    <p>
                        مدرسه فوتسال عقاب قشقایی با هدف پرورش استعدادهای ناب و معرفی آینده‌سازان فوتسال کشور، در محیطی حرفه‌ای و پویا فعالیت می‌کند. ما با بهره‌گیری از مربیان مجرب و دارای مدارک معتبر، بر آموزش اصولی تکنیک‌ها، تاکتیک‌های روز فوتسال و همچنین توسعه ارزش‌های اخلاقی و ورزشی تمرکز داریم.
                    </p>
                    <p>
                        در مدرسه عقاب قشقایی، ما به هر بازیکن به عنوان یک سرمایه نگاه می‌کنیم و تلاش می‌کنیم تا با برنامه‌ریزی دقیق و تمرینات هدفمند، پتانسیل کامل آن‌ها را شکوفا سازیم. امکانات مناسب، توجه به سلامت بازیکنان و ایجاد فضایی دوستانه و رقابتی از دیگر ویژگی‌های مدرسه ماست. اگر به دنبال پیشرفت در فوتسال و ساختن آینده‌ای درخشان در این رشته هستید، مدرسه عقاب قشقایی بهترین انتخاب برای شماست.
                    </p>
                </div>
            </div>
        </section>

        <section id="registration-form-section" class="mb-12"> 
            <div class="card">
                <h2 class="text-3xl font-semibold mb-8 text-center qashqai-border-subtle" style="color: #FF0000;">
                    فرم ثبت نام آنلاین
                </h2>
                <form id="oqbfcForm" class="space-y-6">
                    
                    <fieldset class="border border-gray-600 p-4 rounded-md">
                        <legend class="text-xl font-semibold px-2" style="color: #FF0000;">۱. اطلاعات بازیکن</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                            <div>
                                <label for="playerName" class="block text-sm font-medium form-label">نام <span class="text-red-500">*</span></label>
                                <input type="text" name="playerName" id="playerName" required class="mt-1 block w-full form-input">
                            </div>
                            <div>
                                <label for="playerLastName" class="block text-sm font-medium form-label">نام خانوادگی <span class="text-red-500">*</span></label>
                                <input type="text" name="playerLastName" id="playerLastName" required class="mt-1 block w-full form-input">
                            </div>
                            <div>
                                <label for="playerNationalId" class="block text-sm font-medium form-label">کد ملی <span class="text-red-500">*</span></label>
                                <input type="text" name="playerNationalId" id="playerNationalId" required pattern="[0-9]{10}" title="کد ملی باید ۱۰ رقمی باشد" class="mt-1 block w-full form-input">
                            </div>
                            <div>
                                <label for="playerBirthDate" class="block text-sm font-medium form-label">تاریخ تولد (شمسی) <span class="text-red-500">*</span></label>
                                <input type="text" name="playerBirthDate" id="playerBirthDate" required class="mt-1 block w-full form-input" placeholder="مثال: ۱۴۰۲/۰۱/۱۵" autocomplete="off">
                            </div>
                             <div>
                                <label for="playerGender" class="block text-sm font-medium form-label">جنسیت <span class="text-red-500">*</span></label>
                                <select name="playerGender" id="playerGender" required class="mt-1 block w-full form-input">
                                    <option value="">انتخاب کنید...</option>
                                    <option value="male">پسر</option>
                                    <option value="female">دختر</option>
                                </select>
                            </div>
                            <div>
                                <label for="playerPhoto" class="block text-sm font-medium form-label">آپلود عکس پرسنلی</label>
                                <input type="file" name="playerPhoto" id="playerPhoto" accept="image/*" class="mt-1 block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700 cursor-pointer">
                            </div>
                            <div class="md:col-span-2">
                                <label for="playerAddress" class="block text-sm font-medium form-label">آدرس دقیق محل سکونت <span class="text-red-500">*</span></label>
                                <textarea name="playerAddress" id="playerAddress" rows="3" required class="mt-1 block w-full form-input"></textarea>
                            </div>
                            <div>
                                <label for="playerPosition" class="block text-sm font-medium form-label">پست تخصصی مورد علاقه</label>
                                <input type="text" name="playerPosition" id="playerPosition" class="mt-1 block w-full form-input">
                            </div>
                            <div>
                                <label for="playerSkillLevel" class="block text-sm font-medium form-label">سطح مهارت فعلی <span class="text-red-500">*</span></label>
                                <select name="playerSkillLevel" id="playerSkillLevel" required class="mt-1 block w-full form-input">
                                    <option value="">انتخاب کنید...</option>
                                    <option value="beginner">مبتدی</option>
                                    <option value="intermediate">متوسط</option>
                                    <option value="advanced">با سابقه بازی</option>
                                </select>
                            </div>
                             <div class="md:col-span-2">
                                <label for="playerExperience" class="block text-sm font-medium form-label">سابقه بازی (نام تیم قبلی، مدت عضویت)</label>
                                <input type="text" name="playerExperience" id="playerExperience" class="mt-1 block w-full form-input">
                            </div>
                            <div>
                                <label for="playerShirtSize" class="block text-sm font-medium form-label">سایز لباس ورزشی</label>
                                <input type="text" name="playerShirtSize" id="playerShirtSize" class="mt-1 block w-full form-input">
                            </div>
                             <div>
                                <label for="playerSchoolGrade" class="block text-sm font-medium form-label">مدرسه و مقطع تحصیلی</label>
                                <input type="text" name="playerSchoolGrade" id="playerSchoolGrade" class="mt-1 block w-full form-input">
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="border border-gray-600 p-4 rounded-md">
                        <legend class="text-xl font-semibold px-2" style="color: #FF0000;">۲. اطلاعات والدین/سرپرست (برای بازیکنان زیر ۱۸ سال)</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                            <div>
                                <label for="guardianName" class="block text-sm font-medium form-label">نام و نام خانوادگی ولی/سرپرست</label>
                                <input type="text" name="guardianName" id="guardianName" class="mt-1 block w-full form-input">
                            </div>
                            <div>
                                <label for="guardianRelation" class="block text-sm font-medium form-label">نسبت با بازیکن</label>
                                <input type="text" name="guardianRelation" id="guardianRelation" class="mt-1 block w-full form-input">
                            </div>
                            <div>
                                <label for="guardianNationalId" class="block text-sm font-medium form-label">کد ملی ولی/سرپرست</label>
                                <input type="text" name="guardianNationalId" pattern="[0-9]{10}" title="کد ملی باید ۱۰ رقمی باشد" id="guardianNationalId" class="mt-1 block w-full form-input">
                            </div>
                            <div>
                                <label for="guardianPhone" class="block text-sm font-medium form-label">شماره تماس ضروری ولی/سرپرست <span class="text-red-500">*</span></label>
                                <input type="tel" name="guardianPhone" id="guardianPhone" required class="mt-1 block w-full form-input">
                            </div>
                             <div>
                                <label for="guardianEmail" class="block text-sm font-medium form-label">آدرس ایمیل ولی/سرپرست <span class="text-red-500">*</span></label>
                                <input type="email" name="guardianEmail" id="guardianEmail" required class="mt-1 block w-full form-input">
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="border border-gray-600 p-4 rounded-md">
                        <legend class="text-xl font-semibold px-2" style="color: #FF0000;">۳. اطلاعات پزشکی و بیمه</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                            <div>
                                <label for="playerBloodType" class="block text-sm font-medium form-label">گروه خونی</label>
                                <input type="text" name="playerBloodType" id="playerBloodType" class="mt-1 block w-full form-input">
                            </div>
                            <div class="md:col-span-2">
                                <label for="playerMedicalConditions" class="block text-sm font-medium form-label">بیماری خاص، آلرژی یا حساسیت دارویی</label>
                                <textarea name="playerMedicalConditions" id="playerMedicalConditions" rows="2" class="mt-1 block w-full form-input"></textarea>
                            </div>
                            <div>
                                <label for="playerInsurance" class="block text-sm font-medium form-label">آیا بیمه ورزشی دارد؟</label>
                                <select name="playerInsurance" id="playerInsurance" class="mt-1 block w-full form-input">
                                    <option value="">انتخاب کنید...</option>
                                    <option value="yes">بله</option>
                                    <option value="no">خیر</option>
                                </select>
                            </div>
                             <div>
                                <label for="playerInsuranceDetails" class="block text-sm font-medium form-label">شماره بیمه‌نامه و تاریخ انقضا (در صورت داشتن)</label>
                                <input type="text" name="playerInsuranceDetails" id="playerInsuranceDetails" class="mt-1 block w-full form-input">
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="border border-gray-600 p-4 rounded-md">
                        <legend class="text-xl font-semibold px-2" style="color: #FF0000;">۴. توافق‌نامه‌ها و تعهدات</legend>
                        <div class="space-y-4 mt-4">
                            <div class="flex items-start">
                                <div class="flex items-center h-5">
                                    <input id="rulesAgreement" name="rulesAgreement" type="checkbox" required class="focus:ring-red-500 h-4 w-4 text-red-600 border-gray-500 rounded cursor-pointer">
                                </div>
                                <div class="ml-3 text-sm mr-3">
                                    <label for="rulesAgreement" class="font-medium form-label cursor-pointer">قوانین و مقررات مدرسه فوتسال عقاب قشقایی را مطالعه کرده و می‌پذیرم. (برای مشاهده قوانین <a href="#" class="text-red-400 hover:text-red-300 hover:underline">اینجا کلیک کنید</a>)</label>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="flex items-center h-5">
                                    <input id="parentalConsent" name="parentalConsent" type="checkbox" class="focus:ring-red-500 h-4 w-4 text-red-600 border-gray-500 rounded cursor-pointer">
                                </div>
                                <div class="ml-3 text-sm mr-3">
                                    <label for="parentalConsent" class="font-medium form-label cursor-pointer">والدین/سرپرست قانونی رضایت خود را برای شرکت فرزندشان در تمرینات و مسابقات اعلام می‌دارند.</label>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    
                    <fieldset class="border border-gray-600 p-4 rounded-md">
                        <legend class="text-xl font-semibold px-2" style="color: #FF0000;">۵. نحوه آشنایی</legend>
                         <div class="mt-4">
                            <label for="howHeard" class="block text-sm font-medium form-label">چگونه با مدرسه فوتسال عقاب قشقایی آشنا شدید؟</label>
                            <select id="howHeard" name="howHeard" class="mt-1 block w-full form-input">
                                <option value="">انتخاب کنید...</option>
                                <option value="friends">معرفی دوستان</option>
                                <option value="social_media">شبکه‌های اجتماعی</option>
                                <option value="website">وب‌سایت</option>
                                <option value="advertisement">تبلیغات محیطی/آنلاین</option>
                                <option value="other">سایر موارد</option>
                            </select>
                        </div>
                    </fieldset>

                    <div class="pt-4">
                        <button type="submit" id="submitButton" class="w-full btn-primary font-semibold py-3 px-4 rounded-md shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-red-500 text-lg">
                            <span class="button-text">ارسال اطلاعات و تکمیل ثبت نام</span>
                            <span class="loading-spinner"></span>
                        </button>
                    </div>
                </form>
                <div id="form-message"></div>
            </div>
        </section>
    </main>

    <footer class="mt-12 py-8 qashqai-border-subtle border-t-2 border-gray-700">
        <div class="container mx-auto px-4 text-center text-gray-400">
            <p class="mb-3 text-lg">سوالات پیش از ثبت نام و پشتیبانی:</p>
            <div class="mb-2">
                <div class="contact-item">
                    <span class="font-medium">آقای آقایی: </span>
                    <a href="tel:09139819515" class="text-red-400 hover:text-red-300 hover:underline">۰۹۱۳-۹۸۱-۹۵۱۵</a>
                </div>
                <div class="contact-item">
                    <span class="font-medium">آقای گلستانی: </span>
                    <a href="tel:09197542329" class="text-red-400 hover:text-red-300 hover:underline">۰۹۱۹-۷۵۴-۲۳۲۹</a>
                </div>
                <div class="contact-item">
                    <span class="font-medium">آقای رنجبر: </span>
                    <a href="tel:09306145252" class="text-red-400 hover:text-red-300 hover:underline">۰۹۳۰-۶۱۴-۵۲۵۲</a>
                </div>
                 <div class="contact-item mt-3">
                     <span class="font-medium">ایمیل: </span>
                    <a href="mailto:oqbfc403@gmail.com" class="text-red-400 hover:text-red-300 hover:underline">oqbfc403@gmail.com</a>
                </div>
            </div>
            <p class="text-sm mt-4">
                &copy; <span id="currentYear"></span> تمامی حقوق مادی و معنوی این وب‌سایت متعلق به باشگاه فوتسال عقاب قشقایی می‌باشد.
            </p>
        </div>
    </footer>

    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        if (typeof kamaDatepicker === 'function') {
            kamaDatepicker('playerBirthDate', {
                buttonsColor: "red",
                forceFarsiDigits: true,
                markToday: true,
                markHolidays: true,
                highlightSelectedDay: true,
                syncKeywordsInput: true,
                gotoToday: true,
                pastYearsCount: 80,
                futureYearsCount: 0,
                placeholder: "مثال: ۱۴۰۲/۰۱/۱۵"
            });
        } else {
            console.error("KamaDatepicker library is not loaded or not defined at DOMContentLoaded.");
            const playerBirthDateField = document.getElementById('playerBirthDate');
            if(playerBirthDateField) {
                playerBirthDateField.placeholder = "YYYY/MM/DD - خطای بارگذاری تقویم";
            }
        }

        const form = document.getElementById('oqbfcForm');
        const formMessage = document.getElementById('form-message');
        const submitButton = document.getElementById('submitButton');
        const buttonText = submitButton.querySelector('.button-text');
        const registrationFormSection = document.getElementById('registration-form-section');
        const playerNationalIdInput = document.getElementById('playerNationalId');

        // کلید برای ذخیره کدهای ملی در localStorage
        const REGISTERED_IDS_KEY = 'oqbfc_registered_national_ids';

        function getRegisteredIds() {
            const ids = localStorage.getItem(REGISTERED_IDS_KEY);
            return ids ? JSON.parse(ids) : [];
        }

        function addRegisteredId(nationalId) {
            const ids = getRegisteredIds();
            if (!ids.includes(nationalId)) {
                ids.push(nationalId);
                localStorage.setItem(REGISTERED_IDS_KEY, JSON.stringify(ids));
            }
        }

        function isIdRegistered(nationalId) {
            const ids = getRegisteredIds();
            return ids.includes(nationalId);
        }

        function smoothScrollTo(element, offset = 0) {
            if (element) {
                const elementPosition = element.getBoundingClientRect().top + window.pageYOffset;
                const offsetPosition = elementPosition - offset;
        
                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        }

        form.addEventListener('submit', async function(event) {
            event.preventDefault(); 
            
            submitButton.classList.add('loading');
            submitButton.disabled = true; 
            buttonText.textContent = 'در حال ارسال...'; 
            formMessage.style.display = 'none'; 
            playerNationalIdInput.classList.remove('error-border'); // حذف بردر خطا از کد ملی در هر بار ارسال


            let isValid = true;
            const requiredInputs = form.querySelectorAll('[required]');
            requiredInputs.forEach(input => {
                input.style.borderColor = '#444444'; 
                let valueToTest = input.value;
                if (input.id === 'playerBirthDate' && typeof input.kamadatepicker !== 'undefined' && input.kamadatepicker && typeof input.kamadatepicker.getValue === 'function') {
                     valueToTest = input.kamadatepicker.getValue();
                }
                if ((!valueToTest || !valueToTest.trim()) && input.type !== 'checkbox') {
                    isValid = false;
                    input.style.borderColor = 'red';
                } else if (input.type === 'checkbox' && !input.checked) {
                    isValid = false;
                }
            });

            if (!isValid) {
                formMessage.innerHTML = '<strong>خطا!</strong> لطفاً تمامی فیلدهای ستاره‌دار (*) و موارد ضروری را با دقت تکمیل نمایید.';
                formMessage.className = 'error'; 
                formMessage.style.display = 'block';
                const firstInvalidInput = form.querySelector('[style*="border-color: red"], input[type="checkbox"]:required:not(:checked)');
                if (firstInvalidInput) {
                    firstInvalidInput.focus();
                    smoothScrollTo(registrationFormSection, 20); 
                } else {
                    smoothScrollTo(registrationFormSection, 20);
                }
                submitButton.classList.remove('loading');
                submitButton.disabled = false; 
                buttonText.textContent = 'ارسال اطلاعات و تکمیل ثبت نام';
                return;
            }

            // بررسی تکراری بودن کد ملی
            const nationalId = playerNationalIdInput.value.trim();
            if (isIdRegistered(nationalId)) {
                formMessage.innerHTML = `<strong>خطا!</strong> کد ملی <span dir="ltr" class="font-mono">${nationalId}</span> قبلاً ثبت نام شده است. لطفاً با پشتیبانی تماس بگیرید.`;
                formMessage.className = 'error';
                formMessage.style.display = 'block';
                playerNationalIdInput.classList.add('error-border'); // افزودن بردر قرمز به فیلد کد ملی
                playerNationalIdInput.focus();
                smoothScrollTo(formMessage, 20);

                submitButton.classList.remove('loading');
                submitButton.disabled = false;
                buttonText.textContent = 'ارسال اطلاعات و تکمیل ثبت نام';
                return; 
            }
            
            const formData = new FormData(form);

            try {
                const response = await fetch('https://formspree.io/f/xqabkper', { // آدرس Formspree شما
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    formMessage.innerHTML = `<strong>تبریک! ثبت نام شما با موفقیت انجام شد.</strong><br>به خانواده بزرگ عقاب قشقایی خوش آمدید! همکاران ما به زودی از طریق ایمیل یا شماره تماس با شما در ارتباط خواهند بود. منتظر دیدارتان در زمین هستیم! 🦅`;
                    formMessage.className = 'success'; 
                    
                    addRegisteredId(nationalId); // ذخیره کد ملی پس از ثبت نام موفق

                    form.reset(); 
                    if (typeof kamaDatepicker === 'function' && typeof playerBirthDate.kamadatepicker !== 'undefined' && playerBirthDate.kamadatepicker && typeof playerBirthDate.kamadatepicker.destroy === 'function') {
                        playerBirthDate.kamadatepicker.destroy(); 
                        kamaDatepicker('playerBirthDate', { 
                            buttonsColor: "red", forceFarsiDigits: true, markToday: true, markHolidays: true,
                            highlightSelectedDay: true, syncKeywordsInput: true, gotoToday: true,
                            pastYearsCount: 80, futureYearsCount: 0, placeholder: "مثال: ۱۴۰۲/۰۱/۱۵"
                        });
                    }
                } else {
                    const errorData = await response.json().catch(() => ({})); 
                    console.error('Formspree error data:', errorData);
                    let errorMessage = '<strong>خطا در ارسال اطلاعات.</strong><br>';
                    if (errorData && errorData.errors && errorData.errors.length > 0) {
                        errorMessage += errorData.errors.map(err => err.message || 'خطای نامشخص از سرور').join('<br>');
                    } else if (errorData && errorData.error) {
                        errorMessage += errorData.error;
                    } else {
                        errorMessage += `وضعیت سرور: ${response.status}. لطفاً بعداً دوباره تلاش کنید یا با پشتیبانی تماس بگیرید.`;
                    }
                    formMessage.innerHTML = errorMessage;
                    formMessage.className = 'error';
                }
            } catch (error) {
                console.error('Network or other error submitting to Formspree:', error);
                formMessage.innerHTML = '<strong>خطای شبکه.</strong><br>لطفاً اتصال اینترنت خود را بررسی کرده و دوباره تلاش کنید. در صورت ادامه مشکل، با پشتیبانی تماس بگیرید.';
                formMessage.className = 'error';
            } finally {
                formMessage.style.display = 'block';
                smoothScrollTo(formMessage, 20); 
                submitButton.classList.remove('loading');
                submitButton.disabled = false; 
                buttonText.textContent = 'ارسال اطلاعات و تکمیل ثبت نام';
            }
        });
    }); 
    </script>

</body>
</html>
